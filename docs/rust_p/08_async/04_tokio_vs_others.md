# Tokio vs å…¶ä»–å¼‚æ­¥è¿è¡Œæ—¶

## Rust å¼‚æ­¥è¿è¡Œæ—¶å¯¹æ¯”

Rust ç”Ÿæ€ä¸­æœ‰å¤šä¸ªå¼‚æ­¥è¿è¡Œæ—¶ï¼Œå„æœ‰ç‰¹ç‚¹ã€‚

### ä¸»è¦è¿è¡Œæ—¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Rust å¼‚æ­¥ç”Ÿæ€ç³»ç»Ÿ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tokio        â† æœ€æµè¡Œã€åŠŸèƒ½æœ€å…¨        â”‚
â”‚  async-std    â† æ ‡å‡†åº“é£æ ¼              â”‚
â”‚  smol         â† å°å·§ã€ç®€å•              â”‚
â”‚  embassy      â† åµŒå…¥å¼                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1. Tokio

### ç‰¹ç‚¹

```rust
use tokio;

#[tokio::main]
async fn main() {
    println!("Tokio - æœ€æµè¡Œçš„é€‰æ‹©");
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç”Ÿæ€æœ€ä¸°å¯Œï¼ˆå¤§é‡åº“æ”¯æŒï¼‰
- âœ… æ€§èƒ½ä¼˜ç§€
- âœ… åŠŸèƒ½æœ€å…¨ï¼ˆç½‘ç»œã€æ–‡ä»¶ã€å®šæ—¶å™¨ç­‰ï¼‰
- âœ… æ–‡æ¡£å®Œå–„
- âœ… ç”Ÿäº§éªŒè¯ï¼ˆè¢«å¤§é‡å…¬å¸ä½¿ç”¨ï¼‰
- âœ… æ´»è·ƒç»´æŠ¤

**åŠ£åŠ¿**ï¼š
- âŒ ç›¸å¯¹å¤æ‚
- âŒ ç¼–è¯‘æ—¶é—´è¾ƒé•¿
- âŒ ä¾èµ–è¾ƒå¤š

**é€‚ç”¨åœºæ™¯**ï¼š
- Web æœåŠ¡å™¨ï¼ˆAxumã€Actix-webï¼‰
- å¾®æœåŠ¡
- æ•°æ®åº“åº”ç”¨
- ç½‘ç»œåº”ç”¨
- ç”Ÿäº§ç¯å¢ƒ

**ä¾èµ–**ï¼š
```toml
[dependencies]
tokio = { version = "1", features = ["full"] }
```

## 2. async-std

### ç‰¹ç‚¹

```rust
use async_std;

#[async_std::main]
async fn main() {
    println!("async-std - æ ‡å‡†åº“é£æ ¼");
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… API ä¸æ ‡å‡†åº“ä¸€è‡´ï¼ˆæ˜“å­¦ä¹ ï¼‰
- âœ… ç®€å•æ˜“ç”¨
- âœ… ç¼–è¯‘å¿«
- âœ… ä¾èµ–å°‘

**åŠ£åŠ¿**ï¼š
- âŒ ç”Ÿæ€è¾ƒå°
- âŒ æ€§èƒ½ç•¥é€Šäº Tokio
- âŒ ç»´æŠ¤ä¸å¦‚ Tokio æ´»è·ƒ

**é€‚ç”¨åœºæ™¯**ï¼š
- å­¦ä¹ å¼‚æ­¥ç¼–ç¨‹
- ä¸­å°å‹é¡¹ç›®
- éœ€è¦æ ‡å‡†åº“é£æ ¼ API

**ä¾èµ–**ï¼š
```toml
[dependencies]
async-std = { version = "1", features = ["attributes"] }
```

### API å¯¹æ¯”

```rust
// Tokio
use tokio::fs;
use tokio::io::AsyncReadExt;

#[tokio::main]
async fn main() {
    let mut file = fs::File::open("file.txt").await.unwrap();
    let mut contents = String::new();
    file.read_to_string(&mut contents).await.unwrap();
}

// async-std - å‡ ä¹ç›¸åŒçš„ API
use async_std::fs;
use async_std::io::ReadExt;

#[async_std::main]
async fn main() {
    let mut file = fs::File::open("file.txt").await.unwrap();
    let mut contents = String::new();
    file.read_to_string(&mut contents).await.unwrap();
}
```

## 3. smol

### ç‰¹ç‚¹

```rust
use smol;

fn main() {
    smol::block_on(async {
        println!("smol - å°è€Œç¾");
    })
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… æå°çš„ä»£ç ä½“ç§¯
- âœ… éå¸¸å¿«çš„ç¼–è¯‘é€Ÿåº¦
- âœ… ç®€å•çš„ API
- âœ… çµæ´»æ€§é«˜

**åŠ£åŠ¿**ï¼š
- âŒ ç”Ÿæ€è¾ƒå°
- âŒ åŠŸèƒ½ç›¸å¯¹åŸºç¡€
- âŒ æ–‡æ¡£è¾ƒå°‘

**é€‚ç”¨åœºæ™¯**ï¼š
- åµŒå…¥åˆ°å…¶ä»–åº”ç”¨
- CLI å·¥å…·
- éœ€è¦å¿«é€Ÿç¼–è¯‘
- å°å‹é¡¹ç›®

**ä¾èµ–**ï¼š
```toml
[dependencies]
smol = "2"
```

## 4. embassy

### ç‰¹ç‚¹

```rust
// embassy - åµŒå…¥å¼
#[embassy_executor::main]
async fn main(spawner: Spawner) {
    // åµŒå…¥å¼å¼‚æ­¥ä»£ç 
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… ä¸“ä¸ºåµŒå…¥å¼è®¾è®¡
- âœ… æ— éœ€æ“ä½œç³»ç»Ÿ
- âœ… æä½çš„å†…å­˜å ç”¨
- âœ… å®æ—¶æ€§å¥½

**åŠ£åŠ¿**ï¼š
- âŒ åªé€‚ç”¨äºåµŒå…¥å¼
- âŒ å­¦ä¹ æ›²çº¿é™¡å³­

**é€‚ç”¨åœºæ™¯**ï¼š
- åµŒå…¥å¼ç³»ç»Ÿ
- IoT è®¾å¤‡
- å¾®æ§åˆ¶å™¨

## è¯¦ç»†å¯¹æ¯”è¡¨

| ç‰¹æ€§ | Tokio | async-std | smol | embassy |
|------|-------|-----------|------|---------|
| **ç”Ÿæ€ç³»ç»Ÿ** | â­â­â­â­â­ | â­â­â­ | â­â­ | â­â­ |
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ |
| **æ˜“ç”¨æ€§** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­ |
| **æ–‡æ¡£** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­ |
| **ç¼–è¯‘é€Ÿåº¦** | â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­ |
| **ä»£ç ä½“ç§¯** | å¤§ | ä¸­ | å° | æå° |
| **é€‚ç”¨å¹³å°** | æœåŠ¡å™¨ | é€šç”¨ | é€šç”¨ | åµŒå…¥å¼ |
| **ç»´æŠ¤çŠ¶æ€** | æ´»è·ƒ | ä¸€èˆ¬ | æ´»è·ƒ | æ´»è·ƒ |

## æ€§èƒ½æµ‹è¯•

### ååé‡å¯¹æ¯”

```rust
// æµ‹è¯•åœºæ™¯ï¼šå¤„ç† 10ä¸‡ä¸ªå¹¶å‘è¯·æ±‚

// Tokio
// ååé‡: ~500,000 req/s
#[tokio::main]
async fn tokio_benchmark() {
    // ...
}

// async-std
// ååé‡: ~450,000 req/s
#[async_std::main]
async fn async_std_benchmark() {
    // ...
}

// smol
// ååé‡: ~480,000 req/s
fn smol_benchmark() {
    smol::block_on(async {
        // ...
    })
}
```

### å†…å­˜ä½¿ç”¨

```
Tokio:      ~2.5 MB
async-std:  ~2.0 MB
smol:       ~1.5 MB
```

### ç¼–è¯‘æ—¶é—´

```
Tokio:      ~45s (é¦–æ¬¡ç¼–è¯‘)
async-std:  ~30s
smol:       ~15s
```

## ç”Ÿæ€ç³»ç»Ÿå¯¹æ¯”

### Web æ¡†æ¶æ”¯æŒ

| æ¡†æ¶ | Tokio | async-std | smol |
|------|-------|-----------|------|
| axum | âœ… | âŒ | âŒ |
| actix-web | âœ… | âŒ | âŒ |
| warp | âœ… | âŒ | âŒ |
| tide | âŒ | âœ… | âŒ |
| poem | âœ… | âŒ | âŒ |

### HTTP å®¢æˆ·ç«¯

| åº“ | Tokio | async-std | smol |
|----|-------|-----------|------|
| reqwest | âœ… | âœ… | âš ï¸ |
| surf | âŒ | âœ… | âŒ |
| hyper | âœ… | âŒ | âŒ |

### æ•°æ®åº“

| åº“ | Tokio | async-std | smol |
|----|-------|-----------|------|
| sqlx | âœ… | âœ… | âš ï¸ |
| tokio-postgres | âœ… | âŒ | âŒ |
| async-postgres | âŒ | âœ… | âŒ |

## é€‰æ‹©æŒ‡å—

### é€‰æ‹© Tokio å¦‚æœï¼š

âœ… æ„å»ºç”Ÿäº§åº”ç”¨  
âœ… éœ€è¦ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿ  
âœ… æ€§èƒ½æ˜¯å…³é”®  
âœ… ä½¿ç”¨æµè¡Œçš„ Web æ¡†æ¶  
âœ… å›¢é˜Ÿç†Ÿæ‚‰ Tokio

### é€‰æ‹© async-std å¦‚æœï¼š

âœ… å­¦ä¹ å¼‚æ­¥ç¼–ç¨‹  
âœ… å–œæ¬¢æ ‡å‡†åº“é£æ ¼ API  
âœ… ä¸­å°å‹é¡¹ç›®  
âœ… éœ€è¦å¿«é€ŸåŸå‹  
âœ… ç®€å•æ€§ä¼˜å…ˆ

### é€‰æ‹© smol å¦‚æœï¼š

âœ… éœ€è¦å°çš„äºŒè¿›åˆ¶å¤§å°  
âœ… å¿«é€Ÿç¼–è¯‘é‡è¦  
âœ… CLI å·¥å…·  
âœ… åµŒå…¥åˆ°å…¶ä»–åº”ç”¨  
âœ… çµæ´»æ€§éœ€æ±‚

### é€‰æ‹© embassy å¦‚æœï¼š

âœ… åµŒå…¥å¼å¼€å‘  
âœ… æ— æ“ä½œç³»ç»Ÿç¯å¢ƒ  
âœ… IoT è®¾å¤‡  
âœ… å¾®æ§åˆ¶å™¨

## è¿ç§»æŒ‡å—

### ä» async-std è¿ç§»åˆ° Tokio

```rust
// async-std
use async_std::task;
use async_std::net::TcpListener;

#[async_std::main]
async fn main() {
    let listener = TcpListener::bind("127.0.0.1:8080").await.unwrap();
    // ...
}

// Tokio
use tokio::task;
use tokio::net::TcpListener;

#[tokio::main]
async fn main() {
    let listener = TcpListener::bind("127.0.0.1:8080").await.unwrap();
    // ...
}
```

ä¸»è¦æ”¹åŠ¨ï¼š
1. æ›´æ¢ä¾èµ–
2. æ›¿æ¢ `use` è¯­å¥
3. ä¿®æ”¹å®ï¼ˆ`#[async_std::main]` â†’ `#[tokio::main]`ï¼‰

### ä» Tokio è¿ç§»åˆ° smol

```rust
// Tokio
#[tokio::main]
async fn main() {
    tokio::spawn(async {
        println!("ä»»åŠ¡");
    }).await.unwrap();
}

// smol
fn main() {
    smol::block_on(async {
        smol::spawn(async {
            println!("ä»»åŠ¡");
        }).await;
    })
}
```

## å…¼å®¹æ€§

### futures crate

æ‰€æœ‰è¿è¡Œæ—¶éƒ½å…¼å®¹ `futures` crateï¼š

```rust
use futures::future::join_all;

// å¯ä»¥åœ¨ä»»ä½•è¿è¡Œæ—¶ä½¿ç”¨
#[tokio::main]
async fn main() {
    let futures = vec![
        async { 1 },
        async { 2 },
        async { 3 },
    ];
    
    let results = join_all(futures).await;
    println!("{:?}", results);
}
```

### è¿è¡Œæ—¶æ— å…³çš„ä»£ç 

```rust
// ç¼–å†™è¿è¡Œæ—¶æ— å…³çš„å¼‚æ­¥ä»£ç 
async fn generic_async_function() {
    // ä½¿ç”¨æ ‡å‡† Future å’Œ Stream
    // ä¸ä¾èµ–ç‰¹å®šè¿è¡Œæ—¶
}

// å¯ä»¥åœ¨ä»»ä½•è¿è¡Œæ—¶ä½¿ç”¨
#[tokio::main]
async fn with_tokio() {
    generic_async_function().await;
}

#[async_std::main]
async fn with_async_std() {
    generic_async_function().await;
}
```

## æ··åˆä½¿ç”¨ï¼ˆä¸æ¨èï¼‰

è™½ç„¶æŠ€æœ¯ä¸Šå¯è¡Œï¼Œä½†ä¸æ¨èåœ¨åŒä¸€é¡¹ç›®ä¸­æ··ç”¨è¿è¡Œæ—¶ï¼š

```rust
// âŒ ä¸æ¨è
fn main() {
    // Tokio runtime
    let tokio_rt = tokio::runtime::Runtime::new().unwrap();
    
    // async-std runtime
    async_std::task::block_on(async {
        // ...
    });
    
    // å¯èƒ½å¯¼è‡´é—®é¢˜
}
```

## ç¤¾åŒºå’Œæ”¯æŒ

### GitHub Starsï¼ˆ2024ï¼‰

- Tokio: ~20k+ â­
- async-std: ~3.5k+ â­
- smol: ~1.5k+ â­
- embassy: ~3k+ â­

### ä¼ä¸šä½¿ç”¨

**Tokio**:
- Discord
- Amazon
- Microsoft
- Cloudflare

**async-std**:
- Surf
- ä¸­å°å‹é¡¹ç›®

**smol**:
- ç‹¬ç«‹å¼€å‘è€…
- CLI å·¥å…·

## å†³ç­–æ ‘

```
éœ€è¦å¼‚æ­¥è¿è¡Œæ—¶ï¼Ÿ
â”‚
â”œâ”€ åµŒå…¥å¼? â†’ embassy
â”‚
â”œâ”€ å¿«é€Ÿç¼–è¯‘/å°ä½“ç§¯? â†’ smol
â”‚
â”œâ”€ å­¦ä¹ /ç®€å•é¡¹ç›®? â†’ async-std
â”‚
â””â”€ ç”Ÿäº§åº”ç”¨/æ€§èƒ½/ç”Ÿæ€? â†’ Tokio âœ…
```

## æ€»ç»“

**æ¨èä¼˜å…ˆé€‰æ‹© Tokio**ï¼Œå› ä¸ºï¼š

1. ğŸ† **ç”Ÿæ€æœ€å¥½**ï¼šå‡ ä¹æ‰€æœ‰å¼‚æ­¥åº“éƒ½æ”¯æŒ
2. ğŸš€ **æ€§èƒ½æœ€ä¼˜**ï¼šç»è¿‡å¤§è§„æ¨¡éªŒè¯
3. ğŸ“š **æ–‡æ¡£å®Œå–„**ï¼šå­¦ä¹ èµ„æºä¸°å¯Œ
4. ğŸ¢ **ç”Ÿäº§å°±ç»ª**ï¼šè¢«å¤§é‡ä¼ä¸šä½¿ç”¨
5. ğŸ”§ **åŠŸèƒ½å…¨é¢**ï¼šæ»¡è¶³å„ç§éœ€æ±‚

**å…¶ä»–è¿è¡Œæ—¶çš„ä»·å€¼**ï¼š
- **async-std**ï¼šå­¦ä¹  + ç®€å•é¡¹ç›®
- **smol**ï¼šå¿«é€Ÿç¼–è¯‘ + CLI å·¥å…·
- **embassy**ï¼šåµŒå…¥å¼å¼€å‘

å¯¹äºå¤§å¤šæ•°åº”ç”¨å¼€å‘ï¼Œ**Tokio æ˜¯æœ€ä½³é€‰æ‹©**ï¼ğŸ¦€âš¡

